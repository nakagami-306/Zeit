# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

**Zeit** - iOS向けゲームアプリケーション

### 基本情報
- プロジェクト名: Zeit
- プラットフォーム: iOS
- プロジェクトタイプ: ゲームアプリケーション
- ゲームエンジン: **Godot 4.4.1**
- 開発環境: Windows 11（WSL2上のClaude Code） ※iOS開発のため、実際のビルドにはmacOSが必要

## ゲーム概要

### コンセプト
原始的な小さな村からスタートして、現代的な都市にまで発展させる放置型シミュレーションゲーム。

### ゲームの特徴
- **アプリを開いている間のみゲーム内時間が進行**
- ユーザーは何も操作せず、ただ見守るだけ
- 村が自動的に成長していく過程を楽しむ
  - 家が増える
  - 建物が改築・アップグレードされる
  - 道が整備される
  - 規模が徐々に大きくなる

### ターゲット層
- スマホ依存を脱したい若年層
- Zeit以外の画面を開いている時はゲーム内時間が進行しないことで、他のアプリの使用を抑制

### タイトルの意味
「Zeit」= ドイツ語で「時間」。時間経過とともに成長する村を表現

## 技術スタック
- ゲームエンジン: **Godot 4.4.1** （完全無料、WSL2対応、軽量）
- 開発環境: Windows 11
- プラットフォーム: iOS（初期リリース）、将来的にAndroid対応も検討
- ビジュアルスタイル: **2.5D アイソメトリック視点**
- レンダリング: mobile（モバイル向け最適化）

## 開発環境セットアップ

### Godot実行ファイルの場所
```
Godot_v4.4.1-stable_win64.exe/
├── Godot_v4.4.1-stable_win64.exe      # 通常のGodotエディタ
└── Godot_v4.4.1-stable_win64_console.exe  # コンソール出力付き（デバッグ用）
```

### WSLからGodotを実行する方法
```bash
# エディタを起動
cmd.exe /c "C:\Users\himaj\project\Zeit\Godot_v4.4.1-stable_win64.exe\Godot_v4.4.1-stable_win64.exe -e"

# プロジェクトを実行
cmd.exe /c "C:\Users\himaj\project\Zeit\Godot_v4.4.1-stable_win64.exe\Godot_v4.4.1-stable_win64.exe"

# デバッグモードで実行
cmd.exe /c "C:\Users\himaj\project\Zeit\Godot_v4.4.1-stable_win64.exe\Godot_v4.4.1-stable_win64.exe -d"
```

## プロジェクト構造

```
Zeit/
├── project.godot          # Godotプロジェクト設定ファイル
├── icon.svg              # アプリアイコン
├── addons/               # Godotプラグイン
├── scenes/               # ゲームシーン（.tscn）
│   ├── main.tscn        # メインシーン
│   ├── game/            # ゲームプレイ関連シーン
│   └── ui/              # UI関連シーン
├── scripts/              # GDScriptファイル（.gd）
│   ├── game/            # ゲームロジック
│   ├── ui/              # UIロジック
│   └── systems/         # システム関連（セーブ、時間管理など）
├── assets/               # ゲームアセット
│   ├── sprites/         # 2Dスプライト
│   ├── textures/        # テクスチャ
│   ├── sounds/          # サウンドファイル
│   └── fonts/           # フォント
└── resources/            # Godotリソースファイル（.tres）
```

## 開発ガイドライン

### ファイル命名規則
- シーンファイル: `snake_case.tscn`
- スクリプトファイル: `PascalCase.gd`（クラス名と一致）
- リソースファイル: `snake_case.tres`
- アセットファイル: `snake_case.png/ogg/ttf`

### シーン構造
- メインシーン（main.tscn）をエントリーポイントとする
- 各機能は独立したシーンとして作成し、インスタンス化して使用
- UIとゲームロジックは分離

### スクリプト規約
- 各シーンには対応するスクリプトを作成
- シングルトン（AutoLoad）は`systems/`に配置
- シグナルを活用してコンポーネント間の通信を行う

## ゲーム要件定義

### コアゲームプレイ
1. **自動進行システム**
   - アプリ起動中のみゲーム内時間が進行
   - ユーザーの操作は一切不要（完全放置型）
   - バックグラウンドに移行すると時間停止

2. **村の成長メカニクス**
   - 時間経過に応じて自動的に発展
   - 建物の自動生成・アップグレード
   - 道路網の自然な拡張
   - 人口の増加に応じた建物密度の変化

3. **成長段階**（9つの時代）
   - **太古**
     - 最初の小屋から始まる
     - 草葺き屋根、木造の簡素な住居
   - **古典時代**
     - 石造りの建物、神殿
     - 石畳の道、市場
   - **中世**
     - 木造・レンガの家、城壁
     - 教会、広場、商店街
   - **ルネサンス**
     - 装飾的な建築、大聖堂
     - 芸術工房、図書館
   - **産業時代**
     - 工場、煙突、労働者住宅
     - 鉄道、蒸気機関
   - **近代**
     - コンクリート建築、デパート
     - アスファルト道路、自動車
   - **原子力時代**
     - モダンな高層ビル
     - 高速道路、原子力発電所
   - **情報時代**
     - ガラス張りのオフィスビル
     - データセンター、通信塔
   - **未来時代**
     - 未来的な建築、エコビル
     - 空中道路、緑化都市

### 技術仕様
1. **ビューシステム**
   - アイソメトリック視点
   - カメラ操作:
     - マウスドラッグで視点移動
     - WASD/矢印キーで視点移動
     - 画面端にマウスを置くと自動移動
   - 街全体が画面内に収まるよう自動調整（将来的な実装）
   - グリッドベースの配置システム
   - マップサイズ: 建物数に比例して動的に拡張

2. **時間管理**
   - リアルタイム1秒 = ゲーム内1分
   - デバッグ用の時間加速機能（x1〜x1000、スライダーで調整）
   - 累計プレイ時間の記録

3. **データ管理**
   - 自動セーブ（30秒ごと）
   - 保存データ: 経過時間、建物の位置と状態、人口、現在の時代
   - 単一セーブスロット（アンインストールでデータ削除）
   - ローカルストレージのみ使用

### UI/UX仕様
1. **最小限のインターフェース**
   - 現在の時代表示（画面上部）
   - 経過時間/人口カウンター
   - 設定ボタン（右上）
   - デバッグ用時間調整スライダー（開発時のみ）

2. **視覚的フィードバック**
   - 建物生成・改築時のアニメーション（足場で囲われて一定時間後に完成）
   - 時代遷移時の演出
   - カメラの自動調整（スムーズな移動とズーム）
   - 常に昼間の明るい雰囲気

3. **サウンド設計**
   - 環境音（鳥の声→馬車→車の音）
   - 建設音（控えめな効果音）
   - BGMなし（集中を妨げない）

### パフォーマンス要件
- 60FPS維持（iPhone 8以降）
- メモリ使用量: 200MB以下
- バッテリー消費: 低〜中程度
- オフライン動作可能

### ビジネスモデル
- 完全無料アプリ
- 広告なし
- アプリ内課金なし
- 純粋にスマホ依存対策を目的とした公益的アプリ

### ゲーム開始設定
- **初期状態**: 小屋1つから開始
- **初期人口**: 2〜3人の家族
- **時代進行**: グラデーション的に変化（明確な区切りなし）
- **建物の進化**: 個々の建物が増築・改築を繰り返しながら次の時代の建物へ変化

### 時代進行システム
- **進行時間**: 各時代は均等な時間で進行（具体的な時間はMVP完成後に調整）
- **調整機能**: デバッグ用スライダーで時間経過速度を調整可能
- **エンドゲーム**: 未来時代到達後も無限に継続（建物が増え続ける）

### 建物配置システム
- **成長パターン**: 有機的な成長（ブロック単位で拡張）
- **配置ルール**: 新しい建物は既存建物に隣接（上下左右4方向）
- **建物タイプ**: MVPでは住居のみに限定
- **建物サイズ**: 3x3グリッド（全住居共通）
- **人口システム**: 一定時間ごとに人口増加→住居の増加・アップグレード
- **道路システム**: 
  - ブロック単位で自動生成（現実の都市のような区画）
  - 道路幅: 1マス（全時代共通、見た目のみ変化）
  - 格子状の道路網
  - ブロックサイズ: 12x12マス（3x3の建物を3x3個配置可能）

### 建物アップグレードシステム
- **グレード構成**: 各時代に3つのグレード（例：太古1→太古2→太古3→古典1）
- **進化条件**: グレード3に到達後、次の時代の建物へ移行可能
- **収容人数**: 時代とグレードに応じて変化（例：太古の小屋2人→未来のタワー50人）
- **建築時間**: 
  - 新規建築: 20秒（x1速度時）
  - 改築: 5秒（新規建築の1/4）
- **足場表現**: 建物サイズの簡易的な四角い枠組み

### 初期ゲームパラメータ（仮）
- **最初の人口増加**: ゲーム開始から30秒後
- **人口増加率**: 30秒ごとに1〜2人増加
- **2軒目の建築**: 人口が5人に達した時点
- **建物あたりの収容人数（太古）**: 
  - グレード1: 2人
  - グレード2: 3人
  - グレード3: 4人

### アプリ動作仕様
- **時間進行**: アプリを開いている間のみ（フォアグラウンドのみ）
- **バックグラウンド**: 完全に時間停止
- **通知機能**: なし（スマホ依存対策のため）

## MVP（最小限の実装）仕様
- アイソメトリック視点での村表示
- 太古時代のみ実装（3グレードの住居）
- 時間経過による自動的な建物生成
- ブロック単位の道路システム
- 建築アニメーション（足場表現）
- **成長速度調整スライダー**（x1〜x1000）
- アプリのフォアグラウンド/バックグラウンド検知
- 動的マップ拡張システム

### MVP開発優先順位
1. グリッドシステムとアイソメトリック表示
2. 太古時代の住居（3グレード）とアセット
3. 時間管理とフォアグラウンド検知
4. 建物配置アルゴリズム（4方向隣接）
5. 道路自動生成（ブロック単位）
6. 建築アニメーション
7. カメラ自動調整
8. セーブ/ロード機能

### アセット準備方針
- **初期実装**: 色付き四角形のプレースホルダー
  - 太古グレード1: 茶色
  - 太古グレード2: 濃い茶色
  - 太古グレード3: 赤茶色
  - 道路: グレー
  - 足場: 黄色の枠線
- **将来的な差し替え**: 
  - フリーアセットの活用
  - AIツールでの生成
  - 必要に応じて外注

## 開発メモ
- 2025-06-25: プロジェクト開始、iOS向けゲームアプリ「Zeit」の開発を決定
- 2025-06-25: ゲームコンセプト決定 - スマホ依存対策型の村発展シミュレーション
- 2025-06-25: Godotエンジン採用決定、アイソメトリック視点で開発
- 2025-06-25: 詳細な要件定義完了
  - 9つの時代設定（太古〜未来）
  - 3x3グリッドの建物、12x12のブロックシステム
  - プレースホルダーアセットで開発開始

## 開発ワークフロー

### 新機能追加の手順
1. 必要なシーンとスクリプトの作成場所を確認
2. Godotエディタを起動（上記コマンドを使用）
3. シーンファイル（.tscn）を作成し、対応するGDScriptを作成
4. 機能をテストする際は`-d`オプションでデバッグモード実行

### シーンのテスト実行
```bash
# 特定のシーンを直接実行
cmd.exe /c "C:\Users\himaj\project\Zeit\Godot_v4.4.1-stable_win64.exe\Godot_v4.4.1-stable_win64.exe scenes/main.tscn"

# 現在のシーンを実行（F6キーと同等）
cmd.exe /c "C:\Users\himaj\project\Zeit\Godot_v4.4.1-stable_win64.exe\Godot_v4.4.1-stable_win64.exe --scene"
```

## 実装パターン例

### アイソメトリック視点の基本設定
```gdscript
# カメラの設定例
extends Camera2D

func _ready():
    # アイソメトリック角度（約30度）
    rotation_degrees = -30
    # 適切なズームレベル
    zoom = Vector2(0.5, 0.5)
```

### 時間管理システムの基本構造
```gdscript
# TimeManager.gd (AutoLoad)
extends Node

signal hour_passed
signal day_passed

var game_time: float = 0.0
var time_scale: float = 1.0  # デバッグ用の時間スケール

func _process(delta):
    if get_tree().paused:
        return
    
    game_time += delta * time_scale
    # 時間経過のイベント発火など
```

## 今後の検討事項
1. 村の成長アルゴリズム設計
2. 成長段階の定義（原始時代→古代→中世→近代→現代）
3. UI/UXデザイン（最小限のインターフェース）
4. アセット作成またはフリーアセットの選定
5. サウンド・BGMの検討